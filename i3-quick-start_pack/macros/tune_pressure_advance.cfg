\
[gcode_macro EZ_PA_TUNE]
description: "Pressure advance tuning line 0.00â†’0.12"
gcode:
  {% set start_pa = params.START|default(0.00)|float %}
  {% set end_pa = params.END|default(0.12)|float %}
  {% set step = params.STEP|default(0.02)|float %}
  {% set speed = params.SPEED|default(120)|int %}
  M117 PA Tune
  G90
  G28
  G1 Z0.2 F3000
  G1 X20 Y40 F6000
  G92 E0
  {% set pa_val = start_pa %}
  {% for i in range(0, ( (end_pa - start_pa) / step )|int + 1) %}
    SET_PRESSURE_ADVANCE ADVANCE={pa_val|round(3)}
    M117 PA={pa_val|round(3)}
    G1 X200 E8 F{speed*60}
    G1 Y{40 + (i*1)} F6000
    G1 X20 E8 F{speed*60}
    {% set pa_val = pa_val + step %}
  {% endfor %}
  M117 Read lines; set best PA
